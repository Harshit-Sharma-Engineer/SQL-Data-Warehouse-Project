/*
===============================================================================
Quality Checks
===============================================================================
Script Purpose:
    This script performs various quality checks for data consistency, accuracy, 
    and standardization across the 'silver' layer. It includes checks for:
    - Null or duplicate primary keys.
    - Unwanted spaces in string fields.
    - Data standardization and consistency.
    - Invalid date ranges and orders.
    - Data consistency between related fields.

Usage Notes:
    - Run these checks after data loading Silver Layer.
    - Investigate and resolve any discrepancies found during the checks.
===============================================================================
*/
-------------------------------------------------------------------------------------------------------------------

--- ====================================================================
-- Checking 'silver.crm_cust_info'
-- ====================================================================

-- Data check
-- =================================================
-- 1 -  Check for Nulls or Duplicates in Primary Key 
-- Since a primary key be unique and not null
-- Expectation : No Result
-- =================================================

select * from silver.crm_cust_info;

select 
	cst_id,
	count(*) as cnt 
from silver.crm_cust_info
group by cst_id 
having count(*)>1 or cst_id is null
order by 2 desc;


-- ==================================================
-- 2 - Check for unwanted spaces 
-- Expectation : No Result
-- ==================================================

select 
	cst_firstname  
from silver.crm_cust_info
where cst_firstname != rtrim(ltrim(cst_firstname));

select 
	cst_lastname  
from silver.crm_cust_info
where cst_lastname != rtrim(ltrim(cst_lastname));


-- ==================================================
-- 3 - Check for Data Standardization and Consistency 
-- Expectation : No Result
-- ==================================================

select 
distinct cst_gndr 
from silver.crm_cust_info;

select 
distinct cst_marital_status 
from silver.crm_cust_info;

-------------------------------------------------------------------------------------------------------

-- ====================================================================
-- Checking 'silver.crm_prd_info'
-- ====================================================================
-- =================================================
-- 1 -  Check for Nulls or Duplicates in Primary Key 
-- Since a primary key be unique and not null
-- Expectation : No Result
-- =================================================
select * from silver.crm_prd_info;

select 
	prd_id,
	count(*) as cnt 
from silver.crm_prd_info
group by prd_id 
having count(*)>1 or prd_id is null
order by 2 desc;

-- ==================================================
-- 2 - Check for unwanted spaces 
-- Expectation : No Result
-- ==================================================

select 
	prd_nm  
from silver.crm_prd_info
where prd_nm != rtrim(ltrim(prd_nm));


-- ==================================================
-- 3 - Check Null or negative numbers 
-- Expectation : No Result
-- ==================================================

select 
prd_cost 
from silver.crm_prd_info
where prd_cost is null
or prd_cost like '%-%';


-- ==================================================
-- 4 - Check for Data Standardization and Consistency 
-- Expectation : No Result
-- ==================================================

select 
distinct prd_line 
from silver.crm_prd_info;


-- ==================================================
-- 5 - Check for Invalid Date Orders 
-- Expectation : No Result
-- ==================================================

select 
*
from silver.crm_prd_info
where prd_start_dt > prd_end_dt; 


------------------------------------------------------------------------------------------------------

-- ====================================================================
-- Checking 'silver.crm_sales_details'
-- ====================================================================
-- ==================================================
-- 1 - Check for unwanted spaces 
-- Expectation : No Result
-- ==================================================

select 
	sls_ord_num  
from silver.crm_sales_details
where sls_ord_num != rtrim(ltrim(sls_ord_num));

-- ==================================================
-- 2 - Check for Invalid Dates 
-- Expectation : No Result
-- ==================================================




select 
	sls_order_dt,
	sls_ship_dt 
from silver.crm_sales_details
WHERE sls_ship_dt < sls_order_dt;


select 
	sls_order_dt,
	sls_due_dt 
from silver.crm_sales_details
WHERE sls_due_dt < sls_order_dt;


-- ==================================================
-- 3- Check Data Consistency between Sales,Quantity and  Price
-- Sales = Quantity * Price
-- Expectation: No Results 
-- Values must not be null,negative and zero.
-- ==================================================

select 
	sls_sales,
	sls_quantity,
	sls_price
from silver.crm_sales_details
where sls_sales is null or sls_quantity is null or sls_price is null
or sls_sales = 0 or sls_quantity = 0 or sls_price = 0
or sls_sales like '%-%' or sls_quantity like '%-%' or sls_price like '%-%'
or sls_sales != sls_quantity * sls_price;


select * from silver.crm_sales_details;


---------------------------------------------------------------------------------------------------------------------

-- ====================================================================
-- Checking 'silver.erp_cust_az12'
-- ====================================================================


select * from silver.erp_cust_az12

-- ==================================================
-- 1 - Check for Invalid Dates  and Identify Out-of-Range Dates
-- Expectation : No Result
-- ==================================================

select 
*
from  silver.erp_cust_az12
where  bdate > getdate()

-- ==================================================
-- 2 - Check for Data Standardization and Consistency 
-- Expectation : No Result
-- ==================================================

SELECT DISTINCT 
gen
from silver.erp_cust_az12;

--------------------------------------------------------------------------------------------------------------

-- ====================================================================
-- Checking 'silver.erp_loc_a101'
-- ====================================================================
-- ==================================================
-- 1 - Check for Data Standardization and Consistency 
-- Expectation : No Result
-- ==================================================

select distinct CNTRY
from
silver.erp_loc_a101
order by CNTRY;

select * from silver.erp_loc_a101;

--------------------------------------------------------------------------------------------------

-- ====================================================================
-- Checking 'silver.erp_px_cat_g1v2'
-- ====================================================================

-- ==================================================
-- 1 - Check for unwanted spaces 
-- Expectation : No Result
-- ==================================================

select 
CAT,
SUBCAT
from
silver.erp_px_cat_g1v2
where UPPER(CAT) != UPPER(RTRIM(LTRIM(CAT)))
OR    UPPER(SUBCAT) != UPPER(RTRIM(LTRIM(SUBCAT)))
;

-- ==================================================
-- 2 - Check for Data Standardization and Consistency 
-- Expectation : No Result
-- ==================================================

SELECT DISTINCT 
MAINTENANCE,
CAT
FROM
silver.erp_px_cat_g1v2;

SELECT DISTINCT 
*
FROM
silver.erp_px_cat_g1v2;
